---
title: "Ribasim-MODFLOW 6 Demonstration"
---

## Example: parametrization

In our test cases, we will work with the Dutch national groundwater model
(LHM). For testing, we simplify the top boundary conditions to just three
surface water "systems", from large to small:

1. Primary
2. Secondary
3. Tertiary

These systems are separated in the groundwater model schematization due to the
relatively small size of the surface waters (several meters in width) in
comparison with relatively coarse cells of the groundwater model (250 m): most
cells in the LHM contain more than one surface water, and are included via
representative parameters which take the physical scaling into account. In case
of sufficiently small cell sizes, no overlap occurs and all surface waters can
be represented in a single grid.

Ribasim has no knowledge of these systems unless explicitly separated into
different (sub-)basins. In the examples below, these three systems are
represented by one basin with a single volume. For the purposes of testing, we
have not yet created empirical volume-level relationships for the surface water
of every cell extracted from a hydraulic model. Instead, we have chosen an
(over)simplified parametrization of the hydraulic properties, which makes it
easy to verify the behavior of Ribasim and the coupling procedures:

1. Primary, secondary, and tertiary systems have a rectangular profile: the
  area of the surface water does not change with water level or volume.
2. Water depth is constant for a system within a basin.
3. Water depth increases linearly with volume. (This follows from 1.)
4. Water depth is distributed across the systems in a geometric progression:
  when the tertiary system contains 0.1 m of water, the secondary system contains
0.2 m, and the primary system contains 0.4 m.
5. Water depth is 0.0 m for all systems when basin volume is 0.0. (This follows from 4.)
6. The distribution of water occurs according to the surface water area (width
  times length) used for the LHM parametrization of river bed conductance.

For freely draining basins, a simplified storage-discharge relationship has
been derived as follows:

1. The area of the basin polygon has been multiplied by 1 mm/d (roughly the
average precipitation excess in the Netherlands). This yields a "normative
discharge".
2. A corresponding normative volume has been chosen, corresponding with water
depths of 0.4, 0.2, and 0.1 m for the primary, secondary, and tertiary surface
waters respectively.
3. A dead storage volume has been chosen, corresponding with water depths of
0.2, 0.1, and 0.05 m for the primary, secondary, and tertiary surface waters
respectively. The basin only starts discharging when the storage volume exceeds
this value.

:::{.callout-note}
Ribasim is not limited to such oversimplified parametrization! Ribasim uses
tabulations and therefore supports arbitrary (piecewise linear) volume-depth
and volume-discharge relationships.
:::

A visual representation of this simplified conceptual schematization is given
in @fig-volume-depth and @fig-volume-discharge.

![Distribution of water depths over the primary, secondary, and tertiary system.](https://user-images.githubusercontent.com/13662783/187665858-d01fd60f-f3c2-4662-af82-cf8acfbe169b.PNG){#fig-volume-depth}

![Discharge as a function of basin storage volume.](https://user-images.githubusercontent.com/13662783/187668931-c04d4126-9208-44f5-bafa-4c5f74a96dc9.PNG){#fig-volume-discharge}

An example of the resulting parameters for a single cell is shown in
@tbl-hupsel-v-h. The first row shows the water levels when the basin is empty.
The level for primary, secondary, and tertiary are equal to the bottom
elevation of the surface waters. The second row shows the volume and levels for
water depths of 0.4, 0.2, and 0.1 m. The third row shows the volume and levels
for a tenfold larger volume. This results in implausible water levels with
depths of 4.0, 2.0 and 1.0 m; the water level in the primary system is over
two meters higher than in the tertiary system. In reality, the surface waters
would overflow and surface ponding would occur; this mechanism is ignored
in the test cases for the sake of simplicity.

| Volume (m3) | Primary (m NAP) | Secondary (m NAP) | Tertiary (m NAP) |
|-------------|-----------------|-------------------|------------------|
| 0.0         | 25.65           | 25.83             | 26.60            |
| 6843.1      | 26.05           | 26.03             | 26.70            |
| 68431.0     | 29.65           | 27.83             | 27.60            |

: Volume-level table for a single cell in the Hupsel basin. {#tbl-hupsel-v-h}

@fig-grid-volume shows the volume of the first row of the cell based
input for the primary system. Symbology is set to unique values. While water
levels differ per cell in this parametrization, the "normative volume" defined
above is shared by all cells in a basin.

![Basin normative volume of the primary system.](https://user-images.githubusercontent.com/13662783/187672671-20d22031-3b50-474a-9ee1-4408c25a4f30.PNG){#fig-grid-volume}

@fig-grid-volume shows the water level corresponding to the normative storage
volume based input for the primary system (it corresponds to the value shown in
the first row of the primary column in @tbl-hupsel-v-h). We see a clear gradient
from west to east: as our simplified parametrization assumes a constant water
depth for all cells in a single system, water levels spatially fall and rise
with the bottom elevation.

![Water level corresponding to the normative basin volume of the primary system.](https://user-images.githubusercontent.com/13662783/187672663-99b9efd3-5e09-4d6f-bd3a-4180ff5b2ce4.PNG){#fig-grid-level}

## Example: Configuration

An example of the MODFLOW 6 section of TOML configuration required for a coupled
run can be seen below:

```TOML
[modflow]
simulation = "../data/hupsel/mfsim.nam"
mode = "sequential"
timestep = 86400.0

[modflow.models]

[modflow.models.gwf]
type = "gwf"
dataset = "../data/volume_level_profile-hupsel.nc"
basins = "basin_id"

[[modflow.models.gwf.bounds]]
river = "RIV_P"
drain = "DRN_P"
profile = "profile_primary"

[[modflow.models.gwf.bounds]]
river = "RIV_S"
drain = "DRN_S"
profile = "profile_secondary"

[[modflow.models.gwf.bounds]]
drain = "DRN_T"
profile = "profile_tertiary"
```

The section starts by stating the path to the MODFLOW 6 simulation name file
(`simulation`). The next section contains the information regarding the
MODFLOW 6 model(s) to couple to Ribasim's basins. Per model, a path to the coupling
parameter dataset is provided (`dataset`), along with the variable to use as
the basin identification number (`basins`). Next, for every boundary condition
that should be coupled to Ribasim, the package names (`river`, `drain`) used by
MODFLOW 6 must be specified (as we look for these names in the MODFLOW 6 memory),
along with the name of the variable in the coupling dataset which provides the
volume-level relationship (`profile`).

As can be seen in the example, the coupling mechanism supports coupling of: 

1. A single drainage package (`drain` entry).
2. A single river package (`river` entry).
3. A combination of river and drainage package (when infiltration conductance
does not equal drainage conductance) both (`river` and `drain` entry).

## Test case: Hupsel

To test the coupling, the following simulations have been setup and run:

1. A standalone MODFLOW 6 run of sequential steady-states (i.e. no storage) with
differing groundwater recharge values.
2. A coupled run where the MODFLOW 6 stages are updated by the Ribasim coupler
process, but without Ribasim. This results in volumes of 0.0, so all MODFLOW 6
water levels are set equal to bed elevation.
3. A coupled run where the water levels are updated by Ribasim.

From these tests, we expect the following behavior:

1. Drainage terms should remain largely the same when the water level is lowered in a steady-state:
  the amount of recharge is fixed, and this is locally drained.
2. In case of negative recharge (evapotranspiration), infiltration occurs in the surface waters.
  Infiltration should be zero when the basin volume is 0.

![Water balance of the MODFLOW 6 boundary conditions for the Hupsel basin for a standalone MODFLOW 6 run. The four sequential steady states (01, 02, 03, 04) use net groundwater recharge values of 1.0, 0.5, -0.05 and -0.1 mm/d.](https://user-images.githubusercontent.com/13662783/187715341-fd99dc06-2eda-4b84-a201-650dc7220574.png){#fig-hupsel-gwb-steady}

@fig-hupsel-gwb-steady shows the water balance of steady-state for submodel of the
LHM that has been by selecting the cells belonging to the district containing
the Hupsel catch, the Berkel. 

The Hupsel basin show the expected behavior: for a net groundwater recharge of
1.0 mm/d, most is precipitation with a minor part lateral inflow from higher
areas. In terms of outgoing flows, most of the precipitation ends up in the
surface water, primarily in the many ditches of the tertiary system. Only a
relatively small part of the water leaves the basin via the groundwater.
Interbasin flows through the groundwater form such a minor role, as the aquifer
is thin and transmissivity is limited.

Reducing groundwater recharge to 0.5 mm/d reduces all flows, with the tertiary
system playing a less dominant role, relatively speaking: as its elevation is
the highest compared to the primary and secondary system, the head difference
is reduced strongest for the tertiary system. 

With evapotranspiration (ET) excess (-0.05 and 0.1 mm/d; low values are chosen here
since most ET would be drawn from storage, which is not available in a
steady-state model), the surface waters provide mostly inflow, and recharge is
a negative term. In this case, the secondary system provides a small amount of
infiltration; most of the water is drawn from the surroundings instead.

![Water balance of the MODFLOW 6 boundary conditions for the Hupsel basin for a zero volume run. The four sequential steady states (01, 02, 03, 04) use net groundwater recharge values of 1.0, 0.5, -0.05 and -0.1 mm/d.](https://user-images.githubusercontent.com/13662783/187715349-9eee8830-9b03-4a88-b7c9-b16004c694f6.png){#fig-hupsel-gwb-volume0}

@fig-hupsel-gwb-volume0 shows the same model, with 0-basin volume which causes
water levels to be set equal to bed elevation. Consequently, primary and
secondary outflow terms are larger for positive groundwater recharge as they
drain at a lower level and intercept the water before the tertiary system does.
Secondly, with negative groundwater recharge, no infiltration occurs and the
water is drawn from the surroundings instead. This shows the coupling mechanism
adjusting MODFLOW 6 water levels successfully.

## Test case: de Tol

To test the coupling, the following simulations have been setup and run:

1. A standalone MODFLOW 6 run of sequential steady-states (i.e. no storage) with
differing groundwater recharge values.
2. A coupled run where the MODFLOW 6 stages are updated by the Ribasim coupler
process, but without Ribasim. This results in volumes of 0.0, so all MODFLOW 6
water levels are set equal to bed elevation.
3. A coupled run where the water levels are updated by Ribasim.

![Water balance of the MODFLOW 6 boundary conditions for De Tol basin for a standalone MODFLOW 6 run. The four sequential steady states (01, 02, 03, 04) use net groundwater recharge values of 1.0, 0.5, -0.05 and -0.1 mm/d.](https://user-images.githubusercontent.com/13662783/187769185-f63a5821-dfe8-4d99-b43e-780962e73870.png){#fig-tol-gwb-steady}

@fig-tol-gwb-steady shows the water balance of steady-state for a submodel of
the LHM for the Polder de Tol and its surroundings. While groundwater recharge
is the dominant ingoing flow, lateral groundwater flow (over the entire depth
of the groundwater model) is a sizable inflow for the area; the larger lateral
inflow shows that De Tol is a net receiver of groundwater which is mostly
discharged through the secondary system. In contrast to the Hupsel, the
tertiary system is almost entirely absent: drainage occurs not through
ephemeral tertiary ditches, but by the permanently water-bearing ditches of the
primary and secondary system. Unlike the Hupsel, the water balance does not
shrink to very small discharges, as there is sizable regional groundwater flow.

![Water balance of the MODFLOW 6 boundary conditions for De Tol basin for a zero volume run. The four sequential steady states (01, 02, 03, 04) use net groundwater recharge values of 1.0, 0.5, -0.05 and -0.1 mm/d.](https://user-images.githubusercontent.com/13662783/187769180-91f6344c-3489-4200-8a0c-d5e82a28ebaf.png){#fig-tol-gwb-volume0}

@fig-tol-gwb-volume0 shows the same model, with 0-basin volume which causes
water levels to be set equal to bed elevation. The total discharge is larger:
the primary and secondary systems are set to lower levels, and so the head
difference is larger. While De Tol's evapotranspiration excess can be fed by
the regional groundwater, the primary and secondary ditches also provide some
part; as expected, they do not feed when the coupling mechanism adjusts
MODFLOW 6's water levels.
